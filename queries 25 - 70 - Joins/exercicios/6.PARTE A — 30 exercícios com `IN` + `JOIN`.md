# PARTE A — 30 exercícios com `IN` + `JOIN`

---

## PERGUNTAS

1. **Listar clientes que já aparecem em `lancamento` (têm lançamentos).**

2. **Listar contactos (contacto) associados a clientes que estão `ATIVO` (usando `situacao_enum`).**

3. **Listar fornecedores que já tiveram lançamentos.**

4. **Lançamentos que pertencem a contas específicas (ex.: conta id 1,2,3).**

5. **Clientes com nota >= 8 que aparecem na tabela `lancamento`.**

6. **Categorias pai (id_pai) que têm subcategorias que aparecem em lançamentos.**

7. **Listar clientes que têm contatos (contacto) com CPF em lista específica (3 ou 4 CPFs).**

8. **Lançamentos PENDENTES de clientes de um estado específico (ex.: 'SP').**

9. **Fornecedores que não estão inativos e cujos IDs aparecem em lancamento.**

10. **Listar contas que já receberam lançamentos.**

11. **Clientes que têm lançamentos com categoria filha de uma categoria específica (id = 10).**

12. **Contactos que pertencem a clientes que também são fornecedores (parceria):** (assumindo que cliente e fornecedor são entidades distintas mas com CNPJ que coincidem)

13. **Lançamentos cujo `id_categoria` pertence a categorias de débito (`debito = true`).**

14. **Clientes que têm lançamentos PAGOS e também lançamentos PENDENTES (usando `IN` com subselects distintos).**

15. **Fornecedores cujos lançamentos têm parcela > 1 (parcelados).**

16. **Clientes que têm contacto em departamentos específicos (vários departamentos no `IN`).**

17. **Categorias que aparecem em lançamentos associados a clientes de um dado CEP (prefixo).**

18. **Lançamentos vinculados a contas que foram incluídas nos últimos 30 dias (JOIN + IN).**

19. **Clientes que compraram (têm lancamento) em categorias cujos pais têm `credito = true`.**

20. **Contactos (contacto) cujo cliente tem nota dentro de um conjunto específico (ex.: 5,7,9).**

21. **Clientes com lançamentos cujo valor está acima da média das contas às quais pertencem (subselect com AVG).**

22. **Categorias que não têm pai e aparecem em lançamentos (categorias de topo usadas).**

23. **Clientes que têm contacto com CPF em lista e também lançamentos com vencimento próximo (multi-nível).**

24. **Fornecedores cujos CNPJs aparecem em clientes (caso de empresa que é cliente e fornecedor).**

25. **Clientes que têm lançamentos com categorias que têm descrição não nula.**

26. **Lançamentos associados a clientes e fornecedores pertencentes ao mesmo estado (3 níveis).**

27. **Categorias filhas que aparecem em lançamentos e cujo pai tem `debito = true`.**

28. **Clientes que têm pelo menos uma conta registrada (assumindo relação por CNPJ).**

29. **Lançamentos cujo id_categoria pertence a um conjunto derivado de várias condições (3 subselects).**

30. **Clientes que aparecem em lançamentos cuja conta foi criada depois de certa data e cuja categoria pai está ativa.**

---

## RESPOSTAS

### 1

```sql
SELECT id, nome_empresarial
FROM cliente
WHERE id IN (SELECT id_cliente FROM lancamento);
```

### 2

```sql
SELECT ct.*
FROM contacto ct
WHERE ct.cliente_id IN (
  SELECT c.id FROM cliente c WHERE c.situacao = 'ATIVO'
);
```

### 3

```sql
SELECT f.*
FROM fornecedor f
WHERE f.id IN (SELECT id_fornecedor FROM lancamento WHERE id_fornecedor IS NOT NULL);
```

### 4

```sql
SELECT *
FROM lancamento
WHERE id_conta IN (1,2,3);
```

### 5

```sql
SELECT c.id, c.nome_empresarial, c.nota
FROM cliente c
WHERE c.nota >= 8
  AND c.id IN (SELECT id_cliente FROM lancamento);
```

### 6

```sql
SELECT DISTINCT cat.id, cat.nome
FROM categoria cat
WHERE cat.id IN (
  SELECT c.id_pai FROM categoria c
  WHERE c.id IN (SELECT DISTINCT id_categoria FROM lancamento WHERE id_categoria IS NOT NULL)
);
```

### 7

```sql
SELECT *
FROM cliente
WHERE id IN (
  SELECT cliente_id FROM contacto WHERE cpf IN ('000.000.000-00','111.111.111-11','222.222.222-22')
);
```

### 8

```sql
SELECT l.*
FROM lancamento l
WHERE l.situacao = 'PENDENTE'
  AND l.id_cliente IN (SELECT id FROM cliente WHERE estado = 'SP');
```

### 9

```sql
SELECT f.*
FROM fornecedor f
WHERE f.situacao = 'ATIVO'
  AND f.id IN (SELECT DISTINCT id_fornecedor FROM lancamento WHERE id_fornecedor IS NOT NULL);
```

### 10

```sql
SELECT *
FROM conta
WHERE id IN (SELECT DISTINCT id_conta FROM lancamento WHERE id_conta IS NOT NULL);
```

### 11

```sql
SELECT *
FROM cliente
WHERE id IN (
  SELECT id_cliente FROM lancamento
  WHERE id_categoria IN (
    SELECT id FROM categoria WHERE id_pai = 10
  )
);
```

### 12

```sql
SELECT ct.*
FROM contacto ct
WHERE ct.cliente_id IN (
  SELECT c.id FROM cliente c
  WHERE c.cnpj IN (SELECT f.cnpj FROM fornecedor f)
);
```

### 13

```sql
SELECT l.*
FROM lancamento l
WHERE l.id_categoria IN (SELECT id FROM categoria WHERE debito IS TRUE);
```

### 14

```sql
SELECT DISTINCT c.*
FROM cliente c
WHERE c.id IN (SELECT id_cliente FROM lancamento WHERE situacao = 'PAGO')
  AND c.id IN (SELECT id_cliente FROM lancamento WHERE situacao = 'PENDENTE');
```

### 15

```sql
SELECT f.*
FROM fornecedor f
WHERE f.id IN (SELECT id_fornecedor FROM lancamento WHERE parcela > 1);
```

### 16

```sql
SELECT *
FROM cliente
WHERE id IN (SELECT cliente_id FROM contacto WHERE departamento IN ('Vendas','Compras','Financeiro'));
```

### 17

```sql
SELECT DISTINCT cat.*
FROM categoria cat
WHERE cat.id IN (
  SELECT id_categoria FROM lancamento l
  WHERE l.id_cliente IN (SELECT id FROM cliente WHERE cep LIKE '010%')
);
```

### 18

```sql
SELECT l.*
FROM lancamento l
WHERE l.id_conta IN (
  SELECT id FROM conta WHERE data_inclusao >= now() - interval '30 days'
);
```

### 19

```sql
SELECT DISTINCT c.*
FROM cliente c
WHERE c.id IN (
  SELECT id_cliente FROM lancamento
  WHERE id_categoria IN (
    SELECT id FROM categoria WHERE id_pai IN (
      SELECT id FROM categoria WHERE credito IS TRUE
    )
  )
);
```

### 20

```sql
SELECT ct.*
FROM contacto ct
WHERE ct.cliente_id IN (SELECT id FROM cliente WHERE nota IN (5,7,9));
```

### 21

```sql
SELECT DISTINCT c.*
FROM cliente c
WHERE c.id IN (
  SELECT id_cliente FROM lancamento l
  WHERE l.valor > (
    SELECT AVG(valor) FROM lancamento WHERE id_conta = l.id_conta
  )
);
```

### 22

```sql
SELECT *
FROM categoria
WHERE id_pai IS NULL
  AND id IN (SELECT DISTINCT id_categoria FROM lancamento WHERE id_categoria IS NOT NULL);
```

### 23

```sql
SELECT *
FROM cliente
WHERE id IN (
  SELECT cliente_id FROM contacto WHERE cpf IN ('000.000.000-00','111.111.111-11')
)
AND id IN (
  SELECT id_cliente FROM lancamento WHERE data_vencimento < now() + interval '7 days'
);
```

### 24

```sql
SELECT f.*
FROM fornecedor f
WHERE f.cnpj IN (SELECT c.cnpj FROM cliente c);
```

### 25

```sql
SELECT *
FROM cliente
WHERE id IN (SELECT id_cliente FROM lancamento WHERE id_categoria IN (SELECT id FROM categoria WHERE descricao IS NOT NULL));
```

### 26

```sql
SELECT l.*
FROM lancamento l
WHERE l.id_cliente IN (
  SELECT c.id FROM cliente c WHERE c.estado IN (
    SELECT f.estado FROM fornecedor f
  )
)
AND l.id_fornecedor IN (
  SELECT f.id FROM fornecedor f WHERE f.estado IN (SELECT c.estado FROM cliente c)
);
```

### 27

```sql
SELECT *
FROM categoria
WHERE id IN (
  SELECT id_categoria FROM lancamento WHERE id_categoria IS NOT NULL
)
AND id_pai IN (SELECT id FROM categoria WHERE debito IS TRUE);
```

### 28

```sql
-- Se houver relação de CNPJ entre cliente e conta (ex.: conta tem campo empresa), adaptar.
-- Exemplo hipotético: conta.nome = cliente.nome_empresarial
SELECT c.*
FROM cliente c
WHERE c.nome_empresarial IN (SELECT nome FROM conta);
```

### 29

```sql
SELECT *
FROM lancamento l
WHERE l.id_categoria IN (
  SELECT id FROM categoria WHERE (debito IS TRUE AND descricao IS NOT NULL)
  UNION
  SELECT id FROM categoria WHERE (credito IS TRUE AND nome ILIKE '%venda%')
);
```

### 30

```sql
SELECT DISTINCT c.*
FROM cliente c
WHERE c.id IN (
  SELECT l.id_cliente FROM lancamento l
  WHERE l.id_conta IN (SELECT id FROM conta WHERE data_inclusao > '2025-01-01')
    AND l.id_categoria IN (SELECT id FROM categoria WHERE situacao = 'ATIVO' AND id_pai IS NOT NULL)
);
```
