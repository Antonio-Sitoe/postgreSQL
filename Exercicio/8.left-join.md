1. LEFT JOIN (ou LEFT OUTER JOIN)

O LEFT JOIN retorna todas as linhas da tabela da esquerda, mesmo que não exista correspondência na tabela da direita.
Quando não há correspondência, os campos da tabela da direita vêm como NULL.
É usado quando queremos priorizar os registros principais e apenas complementar com dados relacionados.
Ex.: listar todos os clientes e seus contactos, mesmo clientes sem contacto.

---

# 30 exercícios de **LEFT JOIN** (com respostas)

1. **Listar todos os clientes e os seus contactos (mostrar NULL se não tiver contacto).**

```sql
SELECT c.id, c.nome_empresarial, ct.id AS contacto_id, ct.nome AS contacto_nome
FROM cliente c
LEFT JOIN contacto ct ON ct.cliente_id = c.id;
```

2. **Mostrar todas as contas e o total de lançamentos associados (NULL => 0 se não tiver).**

```sql
SELECT co.id, co.nome, COUNT(l.id) AS total_lancamentos
FROM conta co
LEFT JOIN lancamento l ON l.id_conta = co.id
GROUP BY co.id, co.nome;
```

3. **Listar todas as categorias e pelo menos um lançamento (mostrar NULL quando não houver).**

```sql
SELECT cat.id, cat.nome, l.id AS lancamento_id, l.valor
FROM categoria cat
LEFT JOIN lancamento l ON l.id_categoria = cat.id;
```

4. **Exibir todos os fornecedores e quantos clientes já fizeram lançamentos para cada fornecedor (0 quando nenhum).**

```sql
SELECT f.id, f.nome_empresarial, COUNT(DISTINCT l.id_cliente) AS total_clientes
FROM fornecedor f
LEFT JOIN lancamento l ON l.id_fornecedor = f.id
GROUP BY f.id, f.nome_empresarial;
```

5. **Mostrar todos os clientes e a soma dos valores dos seus lançamentos (NULL quando não houver).**

```sql
SELECT c.id, c.nome_empresarial, SUM(l.valor) AS soma_valor
FROM cliente c
LEFT JOIN lancamento l ON l.id_cliente = c.id
GROUP BY c.id, c.nome_empresarial;
```

6. **Listar todas as contas e a data do último vencimento (maior data_vencimento) ou NULL.**

```sql
SELECT co.id, co.nome, MAX(l.data_vencimento) AS ult_vencimento
FROM conta co
LEFT JOIN lancamento l ON l.id_conta = co.id
GROUP BY co.id, co.nome;
```

7. **Exibir todas as categorias pai e contar quantas filhas cada uma tem (0 se não tiver).**

```sql
SELECT p.id, p.nome, COUNT(c.id) AS total_filhas
FROM categoria p
LEFT JOIN categoria c ON c.id_pai = p.id
GROUP BY p.id, p.nome;
```

8. **Mostrar todos os clientes e o primeiro contacto (menor id) se existir.**

```sql
SELECT c.id, c.nome_empresarial, MIN(ct.id) AS primeiro_contacto_id
FROM cliente c
LEFT JOIN contacto ct ON ct.cliente_id = c.id
GROUP BY c.id, c.nome_empresarial;
```

9. **Listar todas as contas e a média dos valores dos lançamentos (NULL quando não houver).**

```sql
SELECT co.id, co.nome, AVG(l.valor) AS media_valor
FROM conta co
LEFT JOIN lancamento l ON l.id_conta = co.id
GROUP BY co.id, co.nome;
```

10. **Mostrar todos os fornecedores e o total de parcelas (`SUM(total_parcela)`) associadas (NULL se não houver).**

```sql
SELECT f.id, f.nome_empresarial, SUM(l.total_parcela) AS soma_parcelas
FROM fornecedor f
LEFT JOIN lancamento l ON l.id_fornecedor = f.id
GROUP BY f.id, f.nome_empresarial;
```

11. **Listar todas as categorias e o total de clientes que já lançaram algo naquela categoria (contagem distinta).**

```sql
SELECT cat.id, cat.nome, COUNT(DISTINCT l.id_cliente) AS total_clientes
FROM categoria cat
LEFT JOIN lancamento l ON l.id_categoria = cat.id
GROUP BY cat.id, cat.nome;
```

12. **Mostrar todos os clientes e se têm pelo menos um lançamento (flag boolean).**

```sql
SELECT c.id, c.nome_empresarial, CASE WHEN l.id IS NULL THEN FALSE ELSE TRUE END AS tem_lancamento
FROM cliente c
LEFT JOIN lancamento l ON l.id_cliente = c.id
GROUP BY c.id, c.nome_empresarial;
```

13. **Listar todas as contas e a quantidade de fornecedores distintos que apareceram em lançamentos da conta.**

```sql
SELECT co.id, co.nome, COUNT(DISTINCT l.id_fornecedor) AS qtd_fornecedores
FROM conta co
LEFT JOIN lancamento l ON l.id_conta = co.id
GROUP BY co.id, co.nome;
```

14. **Mostrar todos os contactos e o nome do cliente; incluir contactos mesmo que o cliente esteja ausente (teoricamente não deve, mas mantém LEFT JOIN).**

```sql
SELECT ct.id, ct.nome, c.nome_empresarial
FROM contacto ct
LEFT JOIN cliente c ON ct.cliente_id = c.id;
```

15. **Listar todas as categorias e, se existir, a nota média dos fornecedores que receberam lançamentos nessa categoria (usar JOIN via lancamento → fornecedor).**

```sql
SELECT cat.id, cat.nome, AVG(f.nota) AS media_nota_fornecedores
FROM categoria cat
LEFT JOIN lancamento l ON l.id_categoria = cat.id
LEFT JOIN fornecedor f ON f.id = l.id_fornecedor
GROUP BY cat.id, cat.nome;
```

16. **Exibir todos os fornecedores e o último valor de lançamento recebido (MAX(valor) ou NULL).**

```sql
SELECT f.id, f.nome_empresarial, MAX(l.valor) AS maior_valor
FROM fornecedor f
LEFT JOIN lancamento l ON l.id_fornecedor = f.id
GROUP BY f.id, f.nome_empresarial;
```

17. **Mostrar todas as contas e quantos lançamentos PENDENTES existem por conta.**

```sql
SELECT co.id, co.nome, COUNT(l.id) FILTER (WHERE l.situacao = 'PENDENTE') AS pendentes
FROM conta co
LEFT JOIN lancamento l ON l.id_conta = co.id
GROUP BY co.id, co.nome;
```

18. **Listar todos os clientes e quantos contactos ativos cada um tem (0 quando não houver).**

```sql
SELECT c.id, c.nome_empresarial, COUNT(ct.id) FILTER (WHERE ct.situacao = 'ATIVO') AS contactos_ativos
FROM cliente c
LEFT JOIN contacto ct ON ct.cliente_id = c.id
GROUP BY c.id, c.nome_empresarial;
```

19. **Mostrar todas as categorias e o valor total dos lançamentos PAGO em cada categoria.**

```sql
SELECT cat.id, cat.nome, SUM(l.valor) FILTER (WHERE l.situacao = 'PAGO') AS total_pago
FROM categoria cat
LEFT JOIN lancamento l ON l.id_categoria = cat.id
GROUP BY cat.id, cat.nome;
```

20. **Listar todas as contas e o menor valor de lançamento por conta (MIN(valor) ou NULL).**

```sql
SELECT co.id, co.nome, MIN(l.valor) AS menor_valor
FROM conta co
LEFT JOIN lancamento l ON l.id_conta = co.id
GROUP BY co.id, co.nome;
```

21. **Mostrar todos os clientes e a média de valor dos lançamentos por cliente nos últimos 6 meses (NULL se nenhum).**

```sql
SELECT c.id, c.nome_empresarial, AVG(l.valor) AS media_6m
FROM cliente c
LEFT JOIN lancamento l ON l.id_cliente = c.id
  AND l.data_vencimento >= CURRENT_DATE - INTERVAL '6 months'
GROUP BY c.id, c.nome_empresarial;
```

22. **Listar categorias pai e a quantidade total de lançamentos em todas as filhas (0 se nenhuma).**

```sql
SELECT p.id, p.nome, COUNT(l.id) AS total_lancamentos
FROM categoria p
LEFT JOIN categoria f ON f.id_pai = p.id
LEFT JOIN lancamento l ON l.id_categoria = f.id
GROUP BY p.id, p.nome;
```

23. **Exibir todos os fornecedores e mostrar o email do contacto associado sempre que houver (via contacto ligado ao cliente que fez o lançamento — exemplo complexo).**

```sql
SELECT f.id, f.nome_empresarial, ct.email AS email_contacto
FROM fornecedor f
LEFT JOIN lancamento l ON l.id_fornecedor = f.id
LEFT JOIN cliente c ON c.id = l.id_cliente
LEFT JOIN contacto ct ON ct.cliente_id = c.id
GROUP BY f.id, f.nome_empresarial, ct.email;
```

24. **Listar todas as contas e se tiveram lançamentos no ano corrente (flag).**

```sql
SELECT co.id, co.nome,
       CASE WHEN COUNT(l.id) FILTER (WHERE EXTRACT(YEAR FROM l.data_vencimento) = EXTRACT(YEAR FROM CURRENT_DATE)) > 0
            THEN TRUE ELSE FALSE END AS teve_lanc_ano
FROM conta co
LEFT JOIN lancamento l ON l.id_conta = co.id
GROUP BY co.id, co.nome;
```

25. **Mostrar todas as categorias e quantos fornecedores estão ligados (via lançamentos) a cada categoria.**

```sql
SELECT cat.id, cat.nome, COUNT(DISTINCT l.id_fornecedor) AS fornecedores_distintos
FROM categoria cat
LEFT JOIN lancamento l ON l.id_categoria = cat.id
GROUP BY cat.id, cat.nome;
```

26. **Listar todos os clientes e o total de parcelas (SUM(total_parcela)) registradas por cliente.**

```sql
SELECT c.id, c.nome_empresarial, SUM(l.total_parcela) AS soma_parcelas
FROM cliente c
LEFT JOIN lancamento l ON l.id_cliente = c.id
GROUP BY c.id, c.nome_empresarial;
```

27. **Mostrar todas as contas e quantas categorias únicas foram usadas em lançamentos daquela conta.**

```sql
SELECT co.id, co.nome, COUNT(DISTINCT l.id_categoria) AS categorias_usadas
FROM conta co
LEFT JOIN lancamento l ON l.id_conta = co.id
GROUP BY co.id, co.nome;
```

28. **Listar fornecedores e o número de lançamentos nos últimos 3 meses (0 se nenhum).**

```sql
SELECT f.id, f.nome_empresarial, COUNT(l.id) FILTER (WHERE l.data_vencimento >= CURRENT_DATE - INTERVAL '3 months') AS lanc_3m
FROM fornecedor f
LEFT JOIN lancamento l ON l.id_fornecedor = f.id
GROUP BY f.id, f.nome_empresarial;
```

29. **Mostrar todas as categorias e a média de parcelas (`AVG(total_parcela)`) de lançamentos naquela categoria.**

```sql
SELECT cat.id, cat.nome, AVG(l.total_parcela) AS media_parcelas
FROM categoria cat
LEFT JOIN lancamento l ON l.id_categoria = cat.id
GROUP BY cat.id, cat.nome;
```

30. **Listar todos os clientes e o último (mais recente) valor de lançamento que tiveram (NULL se nenhum).**

```sql
SELECT c.id, c.nome_empresarial, (ARRAY_AGG(l.valor ORDER BY l.data_vencimento DESC))[1] AS ultimo_valor
FROM cliente c
LEFT JOIN lancamento l ON l.id_cliente = c.id
GROUP BY c.id, c.nome_empresarial;
```

---

Se quiser, posso:

- transformar isto num ficheiro `.sql` com comentários;
- gerar um PDF (se novamente quiser) — mas disse que já não precisas;
- ou adaptar exercícios para um nível específico (iniciante/intermediário/avançado).

Queres que eu gere **mais exercícios específicos** (por exemplo: com `HAVING`, window functions, CTEs) usando LEFT JOIN?
