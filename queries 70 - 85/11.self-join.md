4. SELF JOIN

O SELF JOIN é um JOIN feito da tabela com ela mesma.
É usado quando registros possuem relação hierárquica ou dependência interna.
Funciona dando nomes diferentes (alias) para a mesma tabela.
Ex.: categorias que possuem subcategorias (categoria.id → categoria.id_pai).

> Use `categoria.id_pai` para hierarquias; use `cliente` para comparar clientes entre si (ex.: clientes na mesma cidade, clientes com mesmo CNPJ prefixo, etc.)

# 30 exercícios de **SELF JOIN** (auto-junções — categoria.id_pai e relações entre clientes)

1. Listar categorias-filhas com o nome da categoria-pai (SELF JOIN `categoria c1 JOIN categoria c2 ON c1.id_pai = c2.id`).
2. Mostrar pares de categorias irmão (mesmo `id_pai`) — cada par listado uma vez.
3. Exibir categorias que não têm pai (raízes) e o número de filhas (SELF JOIN + COUNT).
4. Listar categoria-pai e soma dos valores dos lançamentos em todas as suas filhas.
5. Encontrar clientes que compartilham a mesma cidade — mostrar pares de clientes (SELF JOIN `cliente c1, cliente c2` onde c1.id <> c2.id e c1.cidade = c2.cidade).
6. Listar clientes com mesmo prefixo de CNPJ (ex.: os primeiros 2 dígitos iguais) — pares via SELF JOIN.
7. Exibir contactos duplicados por CPF (SELF JOIN em `contacto` para encontrar CPFs repetidos).
8. Encontrar fornecedores com nomes parecidos (SELF JOIN usando `ILIKE` ou `SIMILARITY` se disponível).
9. Mostrar clientes cujo nome_empresarial é substring de outro cliente (SELF JOIN e `position()` ou `LIKE`).
10. Listar categorias que têm subcategorias até 2 níveis (SELF JOIN dupla: c -> c_filha -> c_neta).
11. Exibir clientes que têm contactos em comum por email (SELF JOIN entre contactos para achar mesmos emails em clientes diferentes).
12. Mostrar fornecedores que possuem endereços iguais (SELF JOIN `fornecedor` por `endereco` + `numero`).
13. Encontrar contas com mesma agência e conta_corrente duplicada (SELF JOIN `conta`).
14. Listar clientes que têm lançamentos com o mesmo fornecedor (pares de clientes por fornecedor via SELF JOIN em agrupamento).
15. Exibir categorias onde pai e filho têm a mesma palavra-chave no nome (SELF JOIN com LIKE).
16. Encontrar contactos cujo nome aparece mais de uma vez (SELF JOIN e COUNT).
17. Listar clientes com notas idênticas e exibir pares (SELF JOIN por `nota`).
18. Mostrar fornecedores que são “semelhantes” por bairro e cidade (SELF JOIN com filters).
19. Exibir pares de categorias-filhas que pertencem ao mesmo pai e comparar seus totais de lançamentos.
20. Encontrar clientes com nomes anagramas (caso simplificado: ordenar letras — mais avançado; pode ser exercício teórico).
21. Listar contas onde `nome` coincide parcialmente (SELF JOIN por `nome ILIKE '%' || other.nome || '%'`).
22. Exibir fornecedores cujo `cnpj` compartilha o mesmo raiz (primeiros 8 caracteres) — SELF JOIN por substring(cnpj,1,8).
23. Encontrar clientes cuja cidade aparece mais de uma vez e listar os agrupamentos (SELF JOIN / GROUP).
24. Mostrar categorias onde pai tem status diferente do filho (SELF JOIN e WHERE c_pai.situacao <> c_filho.situacao).
25. Listar contactos que estão vinculados ao mesmo cliente e têm o mesmo departamento (SELF JOIN em `contacto` por cliente_id e departamento).
26. Encontrar clientes que não possuem relação direta, mas que compartilham fornecedores (SELF JOIN via tabela intermediária `lancamento`).
27. Exibir categorias com subcategorias sem lançamentos — pai com filhos vazios (SELF JOIN + LEFT JOIN em lancamento e HAVING COUNT = 0).
28. Listar clientes cujos nomes repetem parte do nome de outro cliente (SELF JOIN e ILIKE).
29. Mostrar pares de contatos do mesmo cliente com CPF distintos (SELF JOIN para checar duplicidade lógica).
30. Exibir cadeia pai→filho→neto de categorias (3 níveis) via SELF JOIN em cascata.
